<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Multi-scale adaptive kernel density/intensity estimation — multiscale.density • sparr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sparr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fmd_animation/fmd_animation.html">Foot and Mouth disease animation</a>
    </li>
    <li>
      <a href="../articles/fmd_interactive/fmd_interactive.html">Foot and mouth disease interactive</a>
    </li>
    <li>
      <a href="../articles/pbc_interactive/pbc_interactive.html">Primary biliary cirrhosis interactive</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tilmandavies/sparr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multi-scale adaptive kernel density/intensity estimation</h1>
    </div>

    
    <p>Computes adaptive kernel estimates of spatial density/intensity using a 3D
FFT for multiple global bandwidth scales.</p>
    

    <pre class="usage"><span class='fu'>multiscale.density</span>(<span class='no'>pp</span>, <span class='no'>h0</span>, <span class='kw'>hp</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>h0fac</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.25</span>, <span class='fl'>1.5</span>),
  <span class='kw'>edge</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"uniform"</span>, <span class='st'>"none"</span>), <span class='kw'>resolution</span> <span class='kw'>=</span> <span class='fl'>128</span>, <span class='kw'>dimz</span> <span class='kw'>=</span> <span class='fl'>64</span>,
  <span class='kw'>gamma.scale</span> <span class='kw'>=</span> <span class='st'>"geometric"</span>, <span class='kw'>trim</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>intensity</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>pilot.density</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>xy</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>taper</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pp</th>
      <td><p>An object of class <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp'>ppp</a></code> giving the observed
2D data set to be smoothed.</p></td>
    </tr>
    <tr>
      <th>h0</th>
      <td><p>Reference global bandwidth for adaptive smoothing; numeric value &gt;
0. Multiscale estimates will be computed by rescaling this value as per
<code>h0fac</code>.</p></td>
    </tr>
    <tr>
      <th>hp</th>
      <td><p>Pilot bandwidth (scalar, numeric &gt; 0) to be used for fixed
bandwidth estimation of the pilot density. If <code>NULL</code> (default), it will
take on the value of <code>h0</code>. Ignored when <code>pilot.density</code> is
supplied as a pre-defined pixel image.</p></td>
    </tr>
    <tr>
      <th>h0fac</th>
      <td><p>A numeric vector of length 2 stipulating the span of the global
bandwidths in the multiscale estimates. Interpreted as a multiplicative
factor on <code>h0</code>. See `Details'.</p></td>
    </tr>
    <tr>
      <th>edge</th>
      <td><p>Character string dictating edge correction. <code>"uniform"</code>
(default) corrects based on evaluation grid coordinate. Setting <code>edge="none"</code>
requests no edge correction.</p></td>
    </tr>
    <tr>
      <th>resolution</th>
      <td><p>Numeric value &gt; 0. Resolution of evaluation grid in the
spatial domain; the densities/intensities will be returned on a
[<code>resolution</code> \(\times\) <code>resolution</code>] grid.</p></td>
    </tr>
    <tr>
      <th>dimz</th>
      <td><p>Resolution of z- (rescaled bandwidth)-axis in the trivariate
convolution. Higher values increase precision of the multiscale estimates at
a computational cost. See `Details'.</p></td>
    </tr>
    <tr>
      <th>gamma.scale</th>
      <td><p>Scalar, numeric value &gt; 0; controls rescaling of the
variable bandwidths. Defaults to the geometric mean of the bandwidth factors
given the pilot density (as per Silverman, 1986). See the documentation for
<code><a href='bivariate.density.html'>bivariate.density</a></code>.</p></td>
    </tr>
    <tr>
      <th>trim</th>
      <td><p>Numeric value &gt; 0; controls bandwidth truncation for adaptive
estimation. See the documentation for <code><a href='bivariate.density.html'>bivariate.density</a></code>.</p></td>
    </tr>
    <tr>
      <th>intensity</th>
      <td><p>Logical value indicating whether to return an intensity
estimate (integrates to the sample size over the study region), or a density
estimate (default, integrates to 1).</p></td>
    </tr>
    <tr>
      <th>pilot.density</th>
      <td><p>An optional pixel image (class
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>) giving the pilot density to be used for
calculation of the variable bandwidths in adaptive estimation, <b>or</b> a
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp.object'>ppp.object</a></code> giving the data upon which to base a
fixed-bandwidth pilot estimate using <code>hp</code>. See the documentation for
<code><a href='bivariate.density.html'>bivariate.density</a></code>.</p></td>
    </tr>
    <tr>
      <th>xy</th>
      <td><p>Optional alternative specification of the spatial evaluation grid;
matches the argument of the same tag in <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/as.mask'>as.mask</a></code>. If
supplied, <code>resolution</code> is ignored.</p></td>
    </tr>
    <tr>
      <th>taper</th>
      <td><p>Logical value indicating whether to taper off the trivariate
kernel outside the range of <code>h0*h0fac</code> in the scale space; see Davies &amp;
Baddeley (2017). Keep at the default <code>TRUE</code> if you don't know what this
means.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value indicating whether to print function progress.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"msden"</code>. This is very similar to a
<code><a href='bivariate.density.html'>bivden</a></code> object, with lists of pixel
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>ages in the <code>z</code>, <code>him</code>, and <code>q</code>
components (instead of standalone images).</p>
<dt>z</dt><dd><p>A list of the resulting
  density/intensity estimates; each member being a pixel image object of class
  <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>. They are placed in increasing order of the
  discretised values of <code>h0</code>.</p></dd>
<dt>h0</dt><dd><p>A copy of the reference value of <code>h0</code> used.</p></dd>
<dt>h0range</dt><dd><p>A vector of length 2 giving the actual range
  of global bandwidth values available (inclusive).</p></dd>
<dt>hp</dt><dd><p>A copy of the value of <code>hp</code> used.</p></dd>
<dt>h</dt><dd><p>A numeric vector of length equal to the
  number of data points, giving the bandwidth used for the corresponding
  observation in <code>pp</code> with respect to the reference global bandwidth
  <code>h0</code>.</p></dd>
<dt>him</dt><dd><p>A list of pixel images (class <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>),
  corresponding to <code>z</code>, giving the
  `hypothetical' Abramson bandwidth at each pixel coordinate conditional upon
  the observed data and the global bandwidth used.</p></dd>
<dt>q</dt><dd><p>Edge-correction weights; list of pixel <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>ages
  corresponding to <code>z</code> if <code>edge = "uniform"</code>, and <code>NULL</code> if
  <code>edge = "none"</code>.</p></dd>
<dt>gamma</dt><dd><p>The numeric value of <code>gamma.scale</code> used in scaling the bandwidths.</p></dd>
<dt>geometric</dt><dd><p>The geometric mean of the
  untrimmed variable bandwidth factors. This will be identical to <code>gamma</code>
  if <code>gamma.scale = "geometric"</code> as per default.</p></dd>
<dt>pp</dt><dd><p>A copy of the <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp.object'>ppp.object</a></code> initially passed to the
  <code>pp</code> argument, containing the data that were smoothed.</p></dd>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Davies &amp; Baddeley (2017) investigated computational aspects of Abramson's
(1982) adaptive kernel smoother for spatial (2D) data. This function is the
implementation of the 3D convolution via a fast-Fourier transform (FFT)
which allows simultaneous calculation of an adaptive kernel estimate at
multiple global bandwidth scales.</p>
<p>These `multiple global bandwidth scales' are computed with respect to
rescaling a reference value of the global bandwidth passed to the <code>h0</code>
argument. This rescaling is defined by the range provided to the argument
<code>h0fac</code>. For example, by default, the function will compute the
adaptive kernel estimate for a range of global bandwidths between
0.25*<code>h0</code> and 1.5*<code>h0</code>. The exact numeric limits are subject to
discretisation, and so the returned valid range of global bandwidths will
differ slightly. The exact resulting range following function execution is
returned as the <code>h0range</code> element of the result, see `Value' below.</p>
<p>The distinct values of global bandwidth used (which define the
aforementioned <code>h0range</code>) and hence the total number of pixel
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a>ages</code> returned depend on both the width of the span
<code>h0fac</code> and the discretisation applied to the bandwidth axis through
<code>dimz</code>. Increasing this z-resolution will provide more pixel images and
hence greater numeric precision, but increases computational cost. The
returned pixel <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a>ages</code> that represent the multiscale
estimates are stored in a named list (see `Value'), whose names reflect the
corresponding distinct global bandwidth. See `Examples' for the easy way to
extract these distinct global bandwidths.</p>
<p>The user can request an interpolated density/intensity estimate for any
global bandwidth value within <code>h0range</code> by using the
<code><a href='multiscale.slice.html'>multiscale.slice</a></code> function, which returns an object of class
<code><a href='bivariate.density.html'>bivden</a></code>.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Abramson, I. (1982). On bandwidth variation in kernel estimates
--- a square root law, <em>Annals of Statistics</em>, <b>10</b>(4),
1217-1223.</p>
<p>Davies, T.M. and Baddeley A. (2017), Fast computation of
spatially adaptive kernel estimates, <em>Statistics and Computing</em>, [to appear].</p>
<p>Silverman, B.W. (1986), <em>Density Estimation for Statistics and Data Analysis</em>,
Chapman &amp; Hall, New York.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='bivariate.density.html'>bivariate.density</a></code>, <code><a href='multiscale.slice.html'>multiscale.slice</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='fu'>data</span>(<span class='no'>chorley</span>) <span class='co'># Chorley-Ribble data (package 'spatstat')</span>
<span class='no'>ch.multi</span> <span class='kw'>&lt;-</span> <span class='fu'>multiscale.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1</span>)
<span class='fu'>plot</span>(<span class='no'>ch.multi</span>)

<span class='no'>ch.pilot</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='bivariate.density.html'>bivariate.density</a></span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>0.75</span>) <span class='co'># with pre-defined pilot density</span>
<span class='no'>ch.multi2</span> <span class='kw'>&lt;-</span> <span class='fu'>multiscale.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>pilot.density</span><span class='kw'>=</span><span class='no'>ch.pilot</span>$<span class='no'>z</span>)
<span class='fu'>plot</span>(<span class='no'>ch.multi2</span>)

<span class='fu'>data</span>(<span class='no'>pbc</span>)
<span class='co'># widen h0 scale, increase z-axis resolution</span>
<span class='no'>pbc.multi</span> <span class='kw'>&lt;-</span> <span class='fu'>multiscale.density</span>(<span class='no'>pbc</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>2</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>h0fac</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.25</span>,<span class='fl'>2.5</span>),<span class='kw'>dimz</span><span class='kw'>=</span><span class='fl'>128</span>)
<span class='fu'>plot</span>(<span class='no'>pbc.multi</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
T.M. Davies and A. Baddeley

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Tilman M. Davies, Jonathan C. Marshall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
