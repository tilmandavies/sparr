<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Tolerance by <em>p</em>-value surfaces — tolerance • sparr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sparr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fmd_animation/fmd_animation.html">Foot and Mouth disease animation</a>
    </li>
    <li>
      <a href="../articles/fmd_interactive/fmd_interactive.html">Foot and mouth disease interactive</a>
    </li>
    <li>
      <a href="../articles/pbc_interactive/pbc_interactive.html">Primary biliary cirrhosis interactive</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tilmandavies/sparr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tolerance by <em>p</em>-value surfaces</h1>
    </div>

    
    <p>Calculates a <em>p</em>-value surface based on asymptotic theory or
Monte-Carlo (MC) permutations describing the extremity of risk given a fixed
or adaptive kernel-smoothed density-ratio, allowing the drawing of
<em>tolerance contours</em>.</p>
    

    <pre class="usage"><span class='fu'>tolerance</span>(<span class='no'>rs</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"ASY"</span>, <span class='st'>"MC"</span>), <span class='kw'>ref.density</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>beta</span> <span class='kw'>=</span> <span class='fl'>0.025</span>,
  <span class='kw'>ITER</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>parallelise</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>rs</th>
      <td><p>An object of class <code><a href='risk.html'>rrs</a></code> giving the estimated relative
risk function for which to calculate the <em>p</em>-value surface.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>A character string specifying the method of calculation.
<code>"ASY"</code> (default) instructs the function to compute the <em>p</em>-values
using asymptotic theory. <code>"MC"</code> computes the values by random
permutations of the data. See `Details'.</p></td>
    </tr>
    <tr>
      <th>ref.density</th>
      <td><p>Required if <code>rs</code> is based on fixed-bandwidth
estimates of the case and control densities and <code>method = "ASY"</code>.
Either a pixel <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>age or an object of class
<code><a href='bivariate.density.html'>bivden</a></code> giving the reference density to use in asymptotic
formulae. May be unnormalised. Ignored if <code>rs</code> is based on adaptive
kernel estimates or if <code>method = "MC"</code>.</p></td>
    </tr>
    <tr>
      <th>beta</th>
      <td><p>A numeric value \(0 &lt;\) <code>beta</code> \(&lt; 1\) giving the
fineness of the adaptive bandwidth partitioning to use for calculation of
the required quantities for asymptotic adaptive <em>p</em>-value surfaces.
Smaller values provide more accurate bandwidth bins at the cost of
additional computing time, see Davies and Baddeley (2018); the default is
sensible in most cases. Ignored if <code>rs</code> is based on fixed-bandwidth
kernel estimates.</p></td>
    </tr>
    <tr>
      <th>ITER</th>
      <td><p>Number of iterations for the Monte-Carlo permutations. Ignored
if <code>method = "ASY"</code>.</p></td>
    </tr>
    <tr>
      <th>parallelise</th>
      <td><p>Numeric argument to invoke parallel processing, giving
the number of CPU cores to use when <code>method = "MC"</code>. Experimental. Test
your system first using <code><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>parallel::detectCores()</a></code> to identify the
number of cores available to you.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value indicating whether to print function progress
during execution.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to be passed to <code><a href='risk.html'>risk</a></code> when
<code>method = "MC"</code>. While most information needed for the MC repetitions
is implicitly gleaned from the object passed to <code>rs</code>, this ellipsis is
typically used to set the appropriate <code>epsilon</code> and
<code>pilot.symmetry</code> values for the internal calls to <code><a href='risk.html'>risk</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A pixel <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>age of the estimated
<em>p</em>-value surface.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function implements developments in Hazelton and Davies (2009) (fixed)
and Davies and Hazelton (2010) (adaptive) to compute pointwise
<em>p</em>-value surfaces based on asymptotic theory of kernel-smoothed
relative risk surfaces. Alternatively, the user may elect to calculate the
<em>p</em>-value surfaces using Monte-Carlo methods (see Kelsall and Diggle,
1995). Superimposition upon a plot of the risk surface contours of these
<em>p</em>-values at given significance levels (i.e. ``tolerance contours'')
can be an informative way of exploring the statistical significance of the
extremity of risk across the defined study region.</p>
<p>Implementation of the Monte-Carlo method simply involves random allocation of case/control marks and
re-estimation of the risk surface <code>ITER</code> times, against which the
original estimate is compared.  While not dependent on asymptotic theory, it is
computationally expensive, and it has been suggested that it might have some
undesirable practical consequences in certain settings (Hazelton and Davies,
2009). When performing the MC simulations, the same global (and pilot, if
necessary) bandwidths and edge-correction regimens are employed as were used
in the initial density estimates of the observed data. With regard to
arguments to be passed to internal calls of <code><a href='risk.html'>risk</a></code>, the user
should take care to use <code>...</code> to set the <code>epsilon</code> value to match
that which was used in creation of the object passed to <code>rs</code> (if this
was set to a non-default value). Furthermore, if performing MC simulations
for the adaptive relative risk function, the function borrows the value of
the <code>beta</code> argument to speed things up via partitioning, and the user
should additionally access <code>...</code> to set the same <code>pilot.symmetry</code>
value as was used for creation of the object passed to <code>rs</code>, in the
same way as for any non-default use of <code>epsilon</code>. This will ensure the
simulations are all performed under the same conditions as were used to estimate the original risk
function.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The returned <em>p</em>-values are geared so that ``smallness''
corresponds to statistical significance of elevated risk, that is, an
upper-tailed test. The complement of the <em>p</em>-values will yeild
significance of reduced risk; a lower-tailed test. When using
<code><a href='tol.contour.html'>tol.contour</a></code>, the user can control what type of contours to
display.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Davies, T.M. and Baddeley A. (2018), Fast computation of
spatially adaptive kernel estimates, <em>Statistics and Computing</em>, [to appear].</p>
<p>Davies, T.M. and Hazelton, M.L. (2010), Adaptive kernel estimation of spatial relative
risk, <em>Statistics in Medicine</em>, <b>29</b>(23) 2423-2437.</p>
<p>Davies, T.M., Jones, K. and Hazelton, M.L. (2016), Symmetric adaptive smoothing regimens for estimation of the spatial
relative risk function, <em>Computational Statistics &amp; Data Analysis</em>,
<b>101</b>, 12-28.</p>
<p>Hazelton, M.L. and Davies, T.M. (2009), Inference based on kernel estimates
of the relative risk function in geographical epidemiology,
<em>Biometrical Journal</em>, <b>51</b>(1), 98-109.</p>
<p>Kelsall, J.E. and Diggle, P.J. (1995), Kernel estimation of relative risk, <em>Bernoulli</em>,
<b>1</b>, 3-16.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='fu'>data</span>(<span class='no'>pbc</span>)
<span class='no'>h0</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='LSCV.risk.html'>LSCV.risk</a></span>(<span class='no'>pbc</span>,<span class='kw'>method</span><span class='kw'>=</span><span class='st'>"hazelton"</span>);<span class='no'>h0</span>
<span class='no'>pbccas</span> <span class='kw'>&lt;-</span> <span class='fu'>split</span>(<span class='no'>pbc</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]
<span class='no'>pbccon</span> <span class='kw'>&lt;-</span> <span class='fu'>split</span>(<span class='no'>pbc</span>)<span class='kw'>[[</span><span class='fl'>2</span>]]

<span class='co'># ASY</span>
<span class='no'>riskfix</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='risk.html'>risk</a></span>(<span class='no'>pbc</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='no'>h0</span>)
<span class='no'>fixtol1</span> <span class='kw'>&lt;-</span> <span class='fu'>tolerance</span>(<span class='no'>riskfix</span>,<span class='kw'>ref.density</span><span class='kw'>=</span><span class='fu'>density</span>(<span class='no'>pbc</span>,<span class='fu'><a href='OS.html'>OS</a></span>(<span class='no'>pbc</span>)))

<span class='no'>riskada</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='risk.html'>risk</a></span>(<span class='no'>pbc</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='no'>h0</span>,<span class='kw'>adapt</span><span class='kw'>=</span><span class='fl'>TRUE</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fu'><a href='NS.html'>NS</a></span>(<span class='no'>pbc</span>),<span class='kw'>pilot.symmetry</span><span class='kw'>=</span><span class='st'>"pooled"</span>,<span class='kw'>davies.baddeley</span><span class='kw'>=</span><span class='fl'>0.025</span>)
<span class='no'>adatol1</span> <span class='kw'>&lt;-</span> <span class='fu'>tolerance</span>(<span class='no'>riskada</span>)

<span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>2</span>))
<span class='fu'>plot</span>(<span class='no'>riskfix</span>)
<span class='fu'><a href='tol.contour.html'>tol.contour</a></span>(<span class='no'>fixtol1</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.1</span>,<span class='fl'>0.05</span>,<span class='fl'>0.01</span>),<span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>3</span>:<span class='fl'>1</span>,<span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='fu'>plot</span>(<span class='no'>riskada</span>)
<span class='fu'><a href='tol.contour.html'>tol.contour</a></span>(<span class='no'>adatol1</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.1</span>,<span class='fl'>0.05</span>,<span class='fl'>0.01</span>),<span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>3</span>:<span class='fl'>1</span>,<span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>)


<span class='co'># MC</span>
<span class='no'>fixtol2</span> <span class='kw'>&lt;-</span> <span class='fu'>tolerance</span>(<span class='no'>riskfix</span>,<span class='kw'>method</span><span class='kw'>=</span><span class='st'>"MC"</span>,<span class='kw'>ITER</span><span class='kw'>=</span><span class='fl'>200</span>)
<span class='no'>adatol2</span> <span class='kw'>&lt;-</span> <span class='fu'>tolerance</span>(<span class='no'>riskada</span>,<span class='kw'>method</span><span class='kw'>=</span><span class='st'>"MC"</span>,<span class='kw'>ITER</span><span class='kw'>=</span><span class='fl'>200</span>,<span class='kw'>parallelise</span><span class='kw'>=</span><span class='fl'>4</span>) <span class='co'># ~1 minute with parallelisation</span>
<span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>2</span>))
<span class='fu'>plot</span>(<span class='no'>riskfix</span>)
<span class='fu'><a href='tol.contour.html'>tol.contour</a></span>(<span class='no'>fixtol2</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.1</span>,<span class='fl'>0.05</span>,<span class='fl'>0.01</span>),<span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>3</span>:<span class='fl'>1</span>,<span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='fu'>plot</span>(<span class='no'>riskada</span>)
<span class='fu'><a href='tol.contour.html'>tol.contour</a></span>(<span class='no'>adatol2</span>,<span class='kw'>levels</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.1</span>,<span class='fl'>0.05</span>,<span class='fl'>0.01</span>),<span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>3</span>:<span class='fl'>1</span>,<span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='co'># }</span><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
T. M. Davies

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Tilman M. Davies, Jonathan C. Marshall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
