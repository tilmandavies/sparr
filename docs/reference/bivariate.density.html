<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bivariate kernel density/intensity estimation — bivariate.density • sparr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sparr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fmd_animation/fmd_animation.html">Foot and Mouth disease animation</a>
    </li>
    <li>
      <a href="../articles/fmd_interactive/fmd_interactive.html">Foot and mouth disease interactive</a>
    </li>
    <li>
      <a href="../articles/pbc_interactive/pbc_interactive.html">Primary biliary cirrhosis interactive</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tilmandavies/sparr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bivariate kernel density/intensity estimation</h1>
    </div>

    
    <p>Provides an isotropic adaptive or fixed bandwidth kernel density/intensity
estimate of bivariate/planar/2D data.</p>
    

    <pre class="usage"><span class='fu'>bivariate.density</span>(<span class='no'>pp</span>, <span class='no'>h0</span>, <span class='kw'>hp</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>adapt</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>resolution</span> <span class='kw'>=</span> <span class='fl'>128</span>,
  <span class='kw'>gamma.scale</span> <span class='kw'>=</span> <span class='st'>"geometric"</span>, <span class='kw'>edge</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"uniform"</span>, <span class='st'>"diggle"</span>, <span class='st'>"none"</span>),
  <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>intensity</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>trim</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>xy</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>pilot.density</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>leaveoneout</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>parallelise</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>davies.baddeley</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pp</th>
      <td><p>An object of class <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp'>ppp</a></code> giving the observed
2D data set to be smoothed.</p></td>
    </tr>
    <tr>
      <th>h0</th>
      <td><p>Global bandwidth for adaptive smoothing or fixed bandwidth for
constant smoothing. A numeric value &gt; 0.</p></td>
    </tr>
    <tr>
      <th>hp</th>
      <td><p>Pilot bandwidth (scalar, numeric &gt; 0) to be used for fixed
bandwidth estimation of a pilot density in the case of adaptive smoothing.
If <code>NULL</code> (default), it will take on the value of <code>h0</code>. Ignored
when <code>adapt = FALSE</code> or if <code>pilot.density</code> is supplied as a
pre-defined pixel image.</p></td>
    </tr>
    <tr>
      <th>adapt</th>
      <td><p>Logical value indicating whether to perform adaptive kernel
estimation. See `Details'.</p></td>
    </tr>
    <tr>
      <th>resolution</th>
      <td><p>Numeric value &gt; 0. Resolution of evaluation grid; the
density/intensity will be returned on a [<code>resolution</code> \(\times\)
<code>resolution</code>] grid.</p></td>
    </tr>
    <tr>
      <th>gamma.scale</th>
      <td><p>Scalar, numeric value &gt; 0; controls rescaling of the
variable bandwidths. Defaults to the geometric mean of the bandwidth factors
given the pilot density (as per Silverman, 1986). See `Details'.</p></td>
    </tr>
    <tr>
      <th>edge</th>
      <td><p>Character string giving the type of edge correction to employ.
<code>"uniform"</code> (default) corrects based on evaluation grid coordinate and
<code>"diggle"</code> reweights each observation-specific kernel. Setting
<code>edge = "none"</code> requests no edge correction. Further details can be
found in the documentation for <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/density.ppp'>density.ppp</a></code>.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Optional numeric vector of nonnegative weights corresponding to
each observation in <code>pp</code>. Must have length equal to <code>npoints(pp)</code>.</p></td>
    </tr>
    <tr>
      <th>intensity</th>
      <td><p>Logical value indicating whether to return an intensity
estimate (integrates to the sample size over the study region), or a density
estimate (default, integrates to 1).</p></td>
    </tr>
    <tr>
      <th>trim</th>
      <td><p>Numeric value &gt; 0; controls bandwidth truncation for adaptive
estimation. See `Details'.</p></td>
    </tr>
    <tr>
      <th>xy</th>
      <td><p>Optional alternative specification of the evaluation grid; matches
the argument of the same tag in <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/as.mask'>as.mask</a></code>. If
supplied, <code>resolution</code> is ignored.</p></td>
    </tr>
    <tr>
      <th>pilot.density</th>
      <td><p>An optional pixel image (class
  <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>) giving the pilot density to be used for
  calculation of the variable bandwidths in adaptive estimation, <b>or</b> a
  <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp.object'>ppp.object</a></code> giving the data upon which to base a
  fixed-bandwidth pilot estimate using <code>hp[1]</code>. If used, the pixel image
  <em>must</em> be defined over the same domain as the data given
<code>resolution</code> or the supplied pre-set <code>xy</code> evaluation grid;
  <b>or</b> the planar point pattern data must be defined with respect to the
  same polygonal study region as in <code>pp</code>.</p></td>
    </tr>
    <tr>
      <th>leaveoneout</th>
      <td><p>Logical value indicating whether to compute and return
the value of the density/intensity at each data point for an adaptive
estimate. See `Details'.</p></td>
    </tr>
    <tr>
      <th>parallelise</th>
      <td><p>Numeric argument to invoke parallel processing, giving
the number of CPU cores to use when <code>leaveoneout = TRUE</code>. Experimental.
Test your system first using <code><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>parallel::detectCores()</a></code> to identify the
number of cores available to you.</p></td>
    </tr>
    <tr>
      <th>davies.baddeley</th>
      <td><p>An optional numeric vector of length 3 to control
bandwidth partitioning for approximate adaptive estimation, giving the
quantile step values for the variable bandwidths for density/intensity and
edge correction surfaces and the resolution of the edge correction surface.
May also be provided as a single numeric value. See `Details'.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value indicating whether to print a function progress
bar to the console when <code>adapt = TRUE</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>leaveoneout = FALSE</code>, an object of class <code>"bivden"</code>.
This is effectively a list with the following components:</p>
<dt>z</dt><dd><p>The
resulting density/intensity estimate, a pixel image object of class
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>.</p></dd>

<dt>h0</dt><dd><p>A copy of the value of <code>h0</code>
used.</p></dd> <dt>hp</dt><dd><p>A copy of the value of <code>hp</code> used.</p></dd>

<dt>h</dt><dd><p>A numeric
vector of length equal to the number of data points, giving the bandwidth
used for the corresponding observation in <code>pp</code>.</p></dd>

<dt>him</dt><dd><p>A pixel
image (class <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>), giving the `hypothetical' Abramson
bandwidth at each pixel coordinate conditional upon the observed data.
<code>NULL</code> for fixed-bandwidth estimates.</p></dd>

<dt>q</dt><dd><p>Edge-correction
weights; a pixel <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/im'>im</a></code>age if <code>edge = "uniform"</code>, a
numeric vector if <code>edge = "diggle"</code>, and <code>NULL</code> if <code>edge =
"none"</code>.</p></dd>

<dt>gamma</dt><dd><p>The value of \(\gamma\) used in scaling the
bandwidths. <code>NA</code> if a fixed bandwidth estimate is computed.</p></dd>

<dt>geometric</dt><dd><p>The geometric mean \(G\) of the untrimmed bandwidth
factors \(\tilde{f}(x_i)^{-1/2}\). <code>NA</code> if a fixed bandwidth estimate
is computed.</p></dd>

<dt>pp</dt><dd><p>A copy of the <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp.object'>ppp.object</a></code>
initially passed to the <code>pp</code> argument, containing the data that were
smoothed.</p></dd>


Else, if leaveoneout = TRUE, simply a numeric vector of length equal to the
number of data points, giving the leave-one-out value of the function at the
corresponding coordinate.

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Given a data set \(x_1,\dots,x_n\) in 2D, the isotropic kernel estimate of
its probability density function, \(\hat{f}(x)\), is given by
$$\hat{f}(y)=n^{-1}\sum_{i=1}^{n}h(x_i)^{-2}K((y-x_i)/h(x_i)) $$
where \(h(x)\) is the bandwidth function, and \(K(.)\) is the
bivariate standard normal smoothing kernel. Edge-correction factors (not
shown above) are also implemented.</p><dl class='dl-horizontal'>
  <dt><b>Fixed</b></dt><dd><p>The classic fixed bandwidth kernel estimator is used when
    <code>adapt = FALSE</code>. This amounts to setting \(h(u)=\)<code>h0</code> for all \(u\).
    Further details can be found in the documentation for <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/density.ppp'>density.ppp</a></code>.</p></dd>
  <dt><b>Adaptive</b></dt><dd><p>Setting <code>adapt = TRUE</code> requests computation of Abramson's (1982)
    variable-bandwidth estimator. Under this framework, we have
    \(h(u)=\)<code>h0</code>*min[\(\tilde{f}(u)^{-1/2}\),\(G*\)<code>trim</code>]/\(\gamma\),
    where \(\tilde{f}(u)\) is a fixed-bandwidth kernel density estimate
    computed using the pilot bandwidth <code>hp</code>.
    <ul>
<li><p>Global smoothing of the variable bandwidths is controlled with the global bandwidth
        <code>h0</code>.</p></li>
<li><p>In the above statement, \(G\) is the geometric mean of the
        ``bandwidth factors'' \(\tilde{f}(x_i)^{-1/2}\); \(i=1,\dots,n\). By
        default, the variable bandwidths are rescaled by \(\gamma=G\), which is
        set with <code>gamma.scale = "geometric"</code>. This allows <code>h0</code> to be
        considered on the same scale as the smoothing parameter in a fixed-bandwidth
        estimate i.e. on the scale of the recorded data. You can use any other
        rescaling of <code>h0</code> by setting <code>gamma.scale</code> to be any scalar
        positive numeric value; though note this only affects \(\gamma\) -- see
        the next bullet. When using a scale-invariant <code>h0</code>, set
        <code>gamma.scale = 1</code>.</p></li>
<li><p>The variable bandwidths must be trimmed to
        prevent excessive values (Hall and Marron, 1988). This is achieved through
        <code>trim</code>, as can be seen in the equation for \(h(u)\) above. The
        trimming of the variable bandwidths is universally enforced by the geometric
        mean of the bandwidth factors \(G\) independent of the choice of
        \(\gamma\). By default, the function truncates bandwidth factors at five
        times their geometric mean. For stricter trimming, reduce <code>trim</code>, for
        no trimming, set <code>trim = Inf</code>.</p></li>
<li><p>For even moderately sized data sets
        and evaluation grid <code>resolution</code>, adaptive kernel estimation can be
        rather computationally expensive. The argument <code>davies.baddeley</code> is
        used to approximate an adaptive kernel estimate by a sum of fixed bandwidth
        estimates operating on appropriate subsets of <code>pp</code>. These subsets are
        defined by ``bandwidth bins'', which themselves are delineated by a quantile
        step value \(0&lt;\delta&lt;1\). E.g. setting \(\delta=0.05\) will create 20
        bandwidth bins based on the 0.05th quantiles of the Abramson variable
        bandwidths. Adaptive edge-correction also utilises the partitioning, with
        pixel-wise bandwidth bins defined using the value \(0&lt;\beta&lt;1\), and the
        option to decrease the resolution of the edge-correction surface for
        computation to a [\(L\) \(\times\) \(L\)] grid, where \(0 &lt;L
        \le\) <code>resolution</code>. If <code>davies.baddeley</code> is supplied as a vector of
        length 3, then the values <code>[1], [2], and [3]</code> correspond to the
        parameters \(\delta\), \(\beta\), and \(L_M=L_N\) in Davies and
        Baddeley (2018). If the argument is simply a single numeric value, it is
        used for both \(\delta\) and \(\beta\), with
        \(L_M=L_N=\)<code>resolution</code> (i.e. no edge-correction surface
        coarsening).</p></li>
<li><p>Computation of leave-one-out values (when
        <code>leaveoneout = TRUE</code>) is done by brute force, and is therefore very
        computationally expensive for adaptive smoothing. This is because the
        leave-one-out mechanism is applied to both the pilot estimation and the
        final estimation stages. Experimental code to do this via parallel
        processing using the <code>foreach</code> routine is implemented.
        Fixed-bandwidth leave-one-out can be performed directly in
        <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/density.ppp'>density.ppp</a></code>.</p></li>
</ul></p></dd>
</dl>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Abramson, I. (1982). On bandwidth variation in kernel estimates
--- a square root law, <em>Annals of Statistics</em>, <b>10</b>(4),
1217-1223.</p>
<p>Davies, T.M. and Baddeley A. (2018), Fast computation of
spatially adaptive kernel estimates, <em>Statistics and Computing</em>, [to appear].</p>
<p>Davies, T.M. and Hazelton, M.L. (2010), Adaptive kernel estimation of spatial relative
risk, <em>Statistics in Medicine</em>, <b>29</b>(23) 2423-2437.</p>
<p>Davies, T.M., Jones, K. and Hazelton, M.L. (2016), Symmetric adaptive smoothing
regimens for estimation of the spatial relative risk function,
<em>Computational Statistics &amp; Data Analysis</em>, <b>101</b>, 12-28.</p>
<p>Diggle, P.J. (1985), A kernel method for smoothing point process data,
<em>Journal of the Royal Statistical Society, Series C</em>, <b>34</b>(2),
138-147.</p>
<p>Hall P. and Marron J.S. (1988) Variable window width kernel
density estimates of probability densities. <em>Probability Theory and
Related Fields</em>, <b>80</b>, 37-49.</p>
<p>Marshall, J.C. and Hazelton, M.L. (2010) Boundary kernels for adaptive density
estimators on regions with irregular boundaries, <em>Journal of Multivariate
Analysis</em>, <b>101</b>, 949-963.</p>
<p>Silverman, B.W. (1986), <em>Density Estimation for
Statistics and Data Analysis</em>, Chapman &amp; Hall, New York.</p>
<p>Wand, M.P. and Jones, C.M., 1995. <em>Kernel Smoothing</em>, Chapman &amp; Hall, London.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>data</span>(<span class='no'>chorley</span>) <span class='co'># Chorley-Ribble data from package 'spatstat'</span>

<span class='co'># Fixed bandwidth kernel density; uniform edge correction</span>
<span class='no'>chden1</span> <span class='kw'>&lt;-</span> <span class='fu'>bivariate.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1.5</span>)

<span class='co'># Fixed bandwidth kernel density; diggle edge correction; coarser resolution</span>
<span class='no'>chden2</span> <span class='kw'>&lt;-</span> <span class='fu'>bivariate.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1.5</span>,<span class='kw'>edge</span><span class='kw'>=</span><span class='st'>"diggle"</span>,<span class='kw'>resolution</span><span class='kw'>=</span><span class='fl'>64</span>)</div><span class='co'># NOT RUN {</span>
<span class='co'># Adaptive smoothing; uniform edge correction</span>
<span class='no'>chden3</span> <span class='kw'>&lt;-</span> <span class='fu'>bivariate.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1.5</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>adapt</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'># Adaptive smoothing; uniform edge correction; partitioning approximation</span>
<span class='no'>chden4</span> <span class='kw'>&lt;-</span> <span class='fu'>bivariate.density</span>(<span class='no'>chorley</span>,<span class='kw'>h0</span><span class='kw'>=</span><span class='fl'>1.5</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fl'>1</span>,<span class='kw'>adapt</span><span class='kw'>=</span><span class='fl'>TRUE</span>,<span class='kw'>davies.baddeley</span><span class='kw'>=</span><span class='fl'>0.025</span>)

<span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>2</span>))
<span class='fu'>plot</span>(<span class='no'>chden1</span>);<span class='fu'>plot</span>(<span class='no'>chden2</span>);<span class='fu'>plot</span>(<span class='no'>chden3</span>);<span class='fu'>plot</span>(<span class='no'>chden4</span>)
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
T.M. Davies and J.C. Marshall

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Tilman M. Davies, Jonathan C. Marshall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
