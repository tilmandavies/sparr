<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Cross-validation bandwidths for spatial kernel density estimates — LIK.density • sparr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Cross-validation bandwidths for spatial kernel density estimates — LIK.density" />

<meta property="og:description" content="Isotropic fixed or global (for adaptive) bandwidth selection for standalone 2D density/intensity
based on either unbiased least squares cross-validation (LSCV) or likelihood (LIK) cross-validation." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sparr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.2.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fmd_animation/fmd_animation.html">Foot and Mouth disease animation</a>
    </li>
    <li>
      <a href="../articles/fmd_interactive/fmd_interactive.html">Foot and mouth disease interactive</a>
    </li>
    <li>
      <a href="../articles/pbc_interactive/pbc_interactive.html">Primary biliary cirrhosis interactive</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tilmandavies/sparr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Cross-validation bandwidths for spatial kernel density estimates</h1>
    <small class="dont-index">Source: <a href='https://github.com/tilmandavies/sparr/blob/master/R/LIK.density.R'><code>R/LIK.density.R</code></a>, <a href='https://github.com/tilmandavies/sparr/blob/master/R/LSCV.density.R'><code>R/LSCV.density.R</code></a></small>
    <div class="hidden name"><code>CV.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Isotropic fixed or global (for adaptive) bandwidth selection for standalone 2D density/intensity
based on either unbiased least squares cross-validation (LSCV) or likelihood (LIK) cross-validation.</p>
    
    </div>

    <pre class="usage"><span class='fu'>LIK.density</span>(<span class='no'>pp</span>, <span class='kw'>hlim</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>hseq</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>resolution</span> <span class='kw'>=</span> <span class='fl'>64</span>,
  <span class='kw'>edge</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>auto.optim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"fixed"</span>, <span class='st'>"adaptive"</span>),
  <span class='kw'>seqres</span> <span class='kw'>=</span> <span class='fl'>30</span>, <span class='kw'>parallelise</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>zero.action</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='no'>...</span>)

<span class='fu'>LSCV.density</span>(<span class='no'>pp</span>, <span class='kw'>hlim</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>hseq</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>resolution</span> <span class='kw'>=</span> <span class='fl'>64</span>,
  <span class='kw'>edge</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>auto.optim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"fixed"</span>, <span class='st'>"adaptive"</span>),
  <span class='kw'>seqres</span> <span class='kw'>=</span> <span class='fl'>30</span>, <span class='kw'>parallelise</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>zero.action</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pp</th>
      <td><p>An object of class <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/ppp'>ppp</a></code> giving the observed
2D data to be smoothed.</p></td>
    </tr>
    <tr>
      <th>hlim</th>
      <td><p>An optional vector of length 2 giving the limits of the
optimisation routine with respect to the bandwidth. If unspecified, the
function attempts to choose this automatically.</p></td>
    </tr>
    <tr>
      <th>hseq</th>
      <td><p>An optional increasing sequence of bandwidth values at which to
manually evaluate the optimisation criterion. Used only in the case
<code>(!auto.optim &amp;&amp; is.null(hlim))</code>.</p></td>
    </tr>
    <tr>
      <th>resolution</th>
      <td><p>Spatial grid size; the optimisation will be based on a
[<code>resolution</code> \(\times\) <code>resolution</code>] density estimate.</p></td>
    </tr>
    <tr>
      <th>edge</th>
      <td><p>Logical value indicating whether to edge-correct the density
estimates used.</p></td>
    </tr>
    <tr>
      <th>auto.optim</th>
      <td><p>Logical value indicating whether to automate the numerical
optimisation using <code>optimise</code>. If <code>FALSE</code>, the optimisation
criterion is evaluated over <code>hseq</code> (if supplied), or over a seqence of
values controlled by <code>hlim</code> and <code>seqres</code>.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>A character string; <code>"fixed"</code> (default) performs classical leave-one-out
cross-validation for the fixed-bandwidth estimator. Alternatively, <code>"adaptive"</code> utilises
multiscale adaptive kernel estimation (Davies &amp; Baddeley, 2018) to run the cross-validation
in an effort to find a suitable global bandwidth for the adaptive estimator. Note that data points are not `left out' of
the pilot density estimate when using this option (this capability is currently in development). See also the entry for <code>...</code>.</p></td>
    </tr>
    <tr>
      <th>seqres</th>
      <td><p>Optional resolution of an increasing sequence of bandwidth
values. Only used if <code>(!auto.optim &amp;&amp; is.null(hseq))</code>.</p></td>
    </tr>
    <tr>
      <th>parallelise</th>
      <td><p>Numeric argument to invoke parallel processing, giving
the number of CPU cores to use when <code>!auto.optim</code> <b>and</b> <code>type = "fixed"</code>. Experimental. Test
your system first using <code><a href='http://www.rdocumentation.org/packages/parallel/topics/detectCores'>parallel::detectCores()</a></code> to identify the
number of cores available to you.</p></td>
    </tr>
    <tr>
      <th>zero.action</th>
      <td><p>A numeric integer, either <code>-1</code>, <code>0</code> (default), <code>1</code> or <code>2</code> controlling how the function should behave in response to numerical errors at very small bandwidths, when such a bandwidth results in one or more zero or negative density values during the leave-one-out computations. See `Details'.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical value indicating whether to provide function progress
commentary.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments controlling pilot density estimation and multi-scale bandwidth-axis
resolution when <code>type = "adaptive"</code>. Relevant arguments are <code>hp</code>, <code>pilot.density</code>,
<code>gamma.scale</code>, and <code>trim</code> from <code><a href='bivariate.density.html'>bivariate.density</a></code>; and <code>dimz</code> from 
<code><a href='multiscale.density.html'>multiscale.density</a></code>. If <code>hp</code> is missing and required, the function makes a (possibly recursive)
call to <code>LSCV.density</code> to set this using fixed-bandwidth LSCV. The remaining defaults are <code>pilot.density = pp</code>,
<code>gamma.scale = "geometric"</code>, <code>trim = 5</code>, and <code>dimz = resolution</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A single numeric value of the estimated bandwidth (if
  <code>auto.optim = TRUE</code>). Otherwise, a \([\)<code>seqres</code> \(x\) 2\(]\) matrix 
  giving the bandwidth sequence and corresponding CV
  function value.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function implements the bivariate, edge-corrected versions of fixed-bandwidth least squares cross-validation and likelihood cross-validation
as outlined in Sections 3.4.3 and 3.4.4 of Silverman (1986) in order to select an optimal fixed smoothing bandwidth. With <code>type = "adaptive"</code> it may also be used to select the global bandwidth
for adaptive kernel density estimates, making use of multi-scale estimation (Davies and Baddeley, 2018) via <code><a href='multiscale.density.html'>multiscale.density</a></code>.
Note that for computational reasons, the leave-one-out procedure is not performed on the pilot density in the adaptive setting; it
is only performed on the final stage estimate. Current development efforts include extending this functionality, see <code><a href='SLIK.adapt.html'>SLIK.adapt</a></code>. See also `Warning' below.</p>
<p>Where <code>LSCV.density</code> is based on minimisation of an unbiased estimate of the mean integrated squared error (MISE) of the density, <code>LIK.density</code> is based on
maximisation of the cross-validated leave-one-out average of the log-likelihood of the density estimate with respect to \(h\).</p>
<p>In both functions, the argument <code>zero.action</code> can be used to control the level of severity in response to small bandwidths that result (due to numerical error) in at least one density value being zero or less.
When <code>zero.action = -1</code>, the function strictly forbids bandwidths that would result in one or more <em>pixel</em> values of a kernel estimate of the original data (i.e. anything over the whole region) being zero or less---this is the most restrictive truncation. With <code>zero.action = 0</code> (default), the function
automatically forbids bandwidths that yield erroneous values at the leave-one-out data point locations only. With <code>zero.action = 1</code>, the minimum machine value (see <code>.Machine$double.xmin</code> at the prompt) is
used to replace these individual leave-one-out values. When <code>zero.action = 2</code>, the minimum value of the valid (greater than zero) leave-one-out values is used to replace any erroneous leave-one-out values.</p>
    
    <h2 class="hasAnchor" id="warning"><a class="anchor" href="#warning"></a>Warning</h2>

    <p>Leave-one-out CV for bandwidth selection in kernel
density estimation is notoriously unstable in practice and has a tendency to
produce rather small bandwidths, particularly for spatial data. Satisfactory bandwidths are not guaranteed
for every application; <code>zero.action</code> can curb adverse numeric effects for very small bandwidths during the optimisation procedures. This method can also be computationally expensive for
large data sets and fine evaluation grid resolutions. The user may also need to
experiment with adjusting <code>hlim</code> to find a suitable minimum.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Davies, T.M. and Baddeley A. (2018), Fast computation of
spatially adaptive kernel estimates, <em>Statistics and Computing</em>, <b>28</b>(4), 937-956.</p>
<p>Silverman, B.W. (1986), <em>Density Estimation for Statistics
and Data Analysis</em>, Chapman &amp; Hall, New York.</p>
<p>Wand, M.P. and Jones,
C.M., 1995. <em>Kernel Smoothing</em>, Chapman &amp; Hall, London.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='SLIK.adapt.html'>SLIK.adapt</a></code> and functions for bandwidth selection in package
  <code>spatstat</code>: <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/bw.diggle'>bw.diggle</a></code>;
  <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/bw.ppl'>bw.ppl</a></code>; <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/bw.scott'>bw.scott</a></code>;
  <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/bw.frac'>bw.frac</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>data</span>(<span class='no'>pbc</span>)
<span class='no'>pbccas</span> <span class='kw'>&lt;-</span> <span class='fu'>split</span>(<span class='no'>pbc</span>)$<span class='no'>case</span>

<span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>)</div><div class='output co'>#&gt; Searching for optimal h in [0.0999999999999091, 15.2778333333333]...Done.</div><div class='output co'>#&gt; [1] 2.465722</div><div class='input'><span class='fu'>LSCV.density</span>(<span class='no'>pbccas</span>)</div><div class='output co'>#&gt; Searching for optimal h in [0.0999999999999091, 15.2778333333333]...Done.</div><div class='output co'>#&gt; [1] 0.4277125</div><div class='input'>
</div><div class='input'><span class='co'>#* FIXED </span>

<span class='co'># custom limits</span>
<span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>,<span class='kw'>hlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.01</span>,<span class='fl'>4</span>))</div><div class='output co'>#&gt; Searching for optimal h in [0.01, 4]...Done.</div><div class='output co'>#&gt; [1] 2.465704</div><div class='input'><span class='fu'>LSCV.density</span>(<span class='no'>pbccas</span>,<span class='kw'>hlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.01</span>,<span class='fl'>4</span>))</div><div class='output co'>#&gt; Searching for optimal h in [0.01, 4]...Done.</div><div class='output co'>#&gt; [1] 0.4277527</div><div class='input'>
<span class='co'># disable edge correction</span>
<span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>,<span class='kw'>hlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.01</span>,<span class='fl'>4</span>),<span class='kw'>edge</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; Searching for optimal h in [0.01, 4]...Done.</div><div class='output co'>#&gt; [1] 2.245576</div><div class='input'><span class='fu'>LSCV.density</span>(<span class='no'>pbccas</span>,<span class='kw'>hlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.01</span>,<span class='fl'>4</span>),<span class='kw'>edge</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; Searching for optimal h in [0.01, 4]...Done.</div><div class='output co'>#&gt; [1] 0.4277527</div><div class='input'>
<span class='co'># obtain objective function</span>
<span class='no'>hcv</span> <span class='kw'>&lt;-</span> <span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>,<span class='kw'>hlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0.01</span>,<span class='fl'>4</span>),<span class='kw'>auto.optim</span><span class='kw'>=</span><span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; ================================================================================</div><div class='input'><span class='fu'>plot</span>(<span class='no'>hcv</span>);<span class='fu'>abline</span>(<span class='kw'>v</span><span class='kw'>=</span><span class='no'>hcv</span>[<span class='fu'>which.max</span>(<span class='no'>hcv</span>[,<span class='fl'>2</span>]),<span class='fl'>1</span>],<span class='kw'>lty</span><span class='kw'>=</span><span class='fl'>2</span>,<span class='kw'>col</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='img'><img src='CV-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#* ADAPTIVE</span>
<span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"adaptive"</span>)</div><div class='output co'>#&gt; Selecting pilot bandwidth...Done.
#&gt;    [ Found hp = 0.427712498752032 ]
#&gt; Computing multi-scale estimate...Done.
#&gt; Searching for optimal h0 in [0.105866014203302, 13.7203855365642]...Done.</div><div class='output co'>#&gt; [1] 4.221678</div><div class='input'><span class='fu'>LSCV.density</span>(<span class='no'>pbccas</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"adaptive"</span>)</div><div class='output co'>#&gt; Selecting pilot bandwidth...Done.
#&gt;    [ Found hp = 0.427712498752032 ]
#&gt; Computing multi-scale estimate...Done.
#&gt; Searching for optimal h0 in [0.105866014203302, 13.7203855365642]...Done.</div><div class='output co'>#&gt; [1] 3.681714</div><div class='input'>
<span class='co'># change pilot bandwidth used</span>
<span class='fu'>LIK.density</span>(<span class='no'>pbccas</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"adaptive"</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='output co'>#&gt; Computing multi-scale estimate...Done.
#&gt; Searching for optimal h0 in [0.110042177698085, 13.648838390479]...Done.</div><div class='output co'>#&gt; [1] 2.223937</div><div class='input'><span class='fu'>LSCV.density</span>(<span class='no'>pbccas</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"adaptive"</span>,<span class='kw'>hp</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='output co'>#&gt; Computing multi-scale estimate...Done.
#&gt; Searching for optimal h0 in [0.110042177698085, 13.648838390479]...Done.</div><div class='output co'>#&gt; [1] 2.145645</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#warning">Warning</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
T. M. Davies

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Tilman M. Davies, Jonathan C. Marshall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

